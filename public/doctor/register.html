<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Doctor Registration - VeriScript</title>
  <link rel="stylesheet" href="/css/main.css">
  <style>
    .register-container {
      min-height: 100vh;
      padding: 2rem 0;
      background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
    }
    
    .register-card {
      background: white;
      padding: 2.5rem;
      border-radius: 1rem;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2);
      max-width: 600px;
      margin: 0 auto;
    }
    
    .register-header {
      text-align: center;
      margin-bottom: 2rem;
    }
    
    .step-indicator {
      display: flex;
      justify-content: space-between;
      margin-bottom: 2rem;
    }
    
    .step {
      flex: 1;
      text-align: center;
      padding: 0.5rem;
      border-bottom: 3px solid var(--gray-300);
      color: var(--gray-500);
      font-weight: 600;
    }
    
    .step.active {
      border-color: var(--primary-color);
      color: var(--primary-color);
    }
    
    .step.completed {
      border-color: var(--success-color);
      color: var(--success-color);
    }
    
    .form-step {
      display: none;
    }
    
    .form-step.active {
      display: block;
    }
  </style>
</head>
<body>
  <div class="register-container">
    <div class="container">
      <div class="register-card">
        <div class="register-header">
          <div style="font-size: 3rem; margin-bottom: 0.5rem;">üìã</div>
          <h1 style="font-size: 1.75rem; margin-bottom: 0.5rem;">Doctor Registration</h1>
          <p style="color: var(--gray-600);">Join VeriScript and start prescribing digitally</p>
        </div>
        
        <!-- Step Indicator -->
        <div class="step-indicator">
          <div class="step active" data-step="1">1. Personal Info</div>
          <div class="step" data-step="2">2. Professional Details</div>
          <div class="step" data-step="3">3. Account Setup</div>
        </div>
        
        <form id="registerForm">
          <!-- Step 1: Personal Information -->
          <div class="form-step active" data-step="1">
            <div class="form-group">
              <label class="form-label required" for="fullName">Full Name</label>
              <input 
                type="text" 
                id="fullName" 
                class="form-input" 
                placeholder="Dr. John Doe"
                required
              >
            </div>
            
            <div class="form-group">
              <label class="form-label required" for="phone">Phone Number</label>
              <input 
                type="tel" 
                id="phone" 
                class="form-input" 
                placeholder="9876543210"
                pattern="[6-9][0-9]{9}"
                required
              >
              <div class="form-help">10-digit Indian mobile number</div>
            </div>
            
            <div class="form-group">
              <label class="form-label required" for="clinicName">Clinic/Hospital Name</label>
              <input 
                type="text" 
                id="clinicName" 
                class="form-input" 
                placeholder="City Medical Center"
                required
              >
            </div>
            
            <div class="form-group">
              <label class="form-label required" for="address">Clinic Address</label>
              <textarea 
                id="address" 
                class="form-textarea" 
                placeholder="Complete address with city and pincode"
                required
              ></textarea>
            </div>
            
            <button type="button" class="btn btn-primary btn-block" onclick="nextStep()">
              Next Step ‚Üí
            </button>
          </div>
          
          <!-- Step 2: Professional Details -->
          <div class="form-step" data-step="2">
            <div class="form-group">
              <label class="form-label required" for="registrationNumber">Medical Registration Number</label>
              <input 
                type="text" 
                id="registrationNumber" 
                class="form-input" 
                placeholder="MCI/State Medical Council Number"
                required
              >
            </div>
            
            <div class="form-group">
              <label class="form-label required" for="qualification">Qualification</label>
              <input 
                type="text" 
                id="qualification" 
                class="form-input" 
                placeholder="MBBS, MD, etc."
                required
              >
            </div>
            
            <div class="form-group">
              <label class="form-label required" for="specialization">Specialization</label>
              <select id="specialization" class="form-select" required>
                <option value="">Select Specialization</option>
                <option value="General Physician">General Physician</option>
                <option value="Pediatrician">Pediatrician</option>
                <option value="Cardiologist">Cardiologist</option>
                <option value="Dermatologist">Dermatologist</option>
                <option value="Orthopedic">Orthopedic</option>
                <option value="Gynecologist">Gynecologist</option>
                <option value="ENT Specialist">ENT Specialist</option>
                <option value="Ophthalmologist">Ophthalmologist</option>
                <option value="Psychiatrist">Psychiatrist</option>
                <option value="Other">Other</option>
              </select>
            </div>
            
            <div class="form-group">
              <label class="form-label" for="experience">Years of Experience</label>
              <input 
                type="number" 
                id="experience" 
                class="form-input" 
                placeholder="5"
                min="0"
              >
            </div>
            
            <div style="display: flex; gap: 1rem;">
              <button type="button" class="btn btn-outline" onclick="prevStep()">
                ‚Üê Previous
              </button>
              <button type="button" class="btn btn-primary" style="flex: 1;" onclick="nextStep()">
                Next Step ‚Üí
              </button>
            </div>
          </div>
          
          <!-- Step 3: Account Setup -->
          <div class="form-step" data-step="3">
            <div class="form-group">
              <label class="form-label required" for="email">Email Address</label>
              <input 
                type="email" 
                id="email" 
                class="form-input" 
                placeholder="doctor@example.com"
                required
              >
            </div>
            
            <div class="form-group">
              <label class="form-label required" for="password">Password</label>
              <input 
                type="password" 
                id="password" 
                class="form-input" 
                placeholder="Minimum 8 characters"
                minlength="8"
                required
              >
              <div class="form-help">At least 8 characters with letters and numbers</div>
            </div>
            
            <div class="form-group">
              <label class="form-label required" for="confirmPassword">Confirm Password</label>
              <input 
                type="password" 
                id="confirmPassword" 
                class="form-input" 
                placeholder="Re-enter password"
                minlength="8"
                required
              >
            </div>
            
            <div class="form-group">
              <label style="display: flex; align-items: start; gap: 0.5rem; cursor: pointer;">
                <input type="checkbox" id="terms" required style="margin-top: 0.25rem;">
                <span style="font-size: 0.875rem;">
                  I agree to the <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a>. 
                  I confirm that I am a registered medical practitioner.
                </span>
              </label>
            </div>
            
            <div style="display: flex; gap: 1rem;">
              <button type="button" class="btn btn-outline" onclick="prevStep()">
                ‚Üê Previous
              </button>
              <button type="submit" class="btn btn-primary" style="flex: 1;">
                Create Account
              </button>
            </div>
          </div>
        </form>
        
        <div style="text-align: center; margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--gray-200);">
          <p style="color: var(--gray-600);">
            Already have an account? 
            <a href="/doctor/login.html" style="font-weight: 600;">Sign in here</a>
          </p>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Loading Spinner -->
  <div id="loader" class="loader">
    <div class="loader-content">
      <div class="spinner"></div>
      <div class="loader-text">Creating your account...</div>
    </div>
  </div>
  
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  
  <!-- App Scripts -->
  <script src="/js/config.js"></script>
  <script src="/js/utils.js"></script>
  
  <script>
    let currentStep = 1;
    
    function nextStep() {
      // Validate current step
      const currentStepElement = document.querySelector(`.form-step[data-step="${currentStep}"]`);
      const inputs = currentStepElement.querySelectorAll('input[required], select[required], textarea[required]');
      
      let isValid = true;
      inputs.forEach(input => {
        if (!input.checkValidity()) {
          input.reportValidity();
          isValid = false;
        }
      });
      
      if (!isValid) return;
      
      // Move to next step
      if (currentStep < 3) {
        currentStep++;
        updateSteps();
      }
    }
    
    function prevStep() {
      if (currentStep > 1) {
        currentStep--;
        updateSteps();
      }
    }
    
    function updateSteps() {
      // Update step indicators
      document.querySelectorAll('.step').forEach(step => {
        const stepNum = parseInt(step.dataset.step);
        step.classList.remove('active', 'completed');
        
        if (stepNum === currentStep) {
          step.classList.add('active');
        } else if (stepNum < currentStep) {
          step.classList.add('completed');
        }
      });
      
      // Update form steps
      document.querySelectorAll('.form-step').forEach(step => {
        step.classList.remove('active');
      });
      document.querySelector(`.form-step[data-step="${currentStep}"]`).classList.add('active');
    }
    
    // Form submission
    document.getElementById('registerForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      // Validate passwords match
      const password = document.getElementById('password').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      
      if (password !== confirmPassword) {
        utils.showToast('Passwords do not match', 'error');
        return;
      }
      
      utils.showLoading('Creating your account...');
      
      try {
        const email = document.getElementById('email').value;
        
        // Create Firebase Auth user
        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
        const user = userCredential.user;
        
        // Create user profile in Firestore
        await db.collection('users').doc(user.uid).set({
          role: 'doctor',
          email: email,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        // Create doctor profile
        await db.collection('doctors').doc(user.uid).set({
          fullName: document.getElementById('fullName').value,
          phone: document.getElementById('phone').value,
          clinicName: document.getElementById('clinicName').value,
          address: document.getElementById('address').value,
          registrationNumber: document.getElementById('registrationNumber').value,
          qualification: document.getElementById('qualification').value,
          specialization: document.getElementById('specialization').value,
          experience: parseInt(document.getElementById('experience').value) || 0,
          email: email,
          userId: user.uid,
          subscriptionPlan: 'free',
          subscriptionStatus: 'active',
          prescriptionCount: 0,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        utils.showToast('Account created successfully!', 'success');
        
        // Redirect to dashboard
        setTimeout(() => {
          window.location.href = '/doctor/dashboard.html';
        }, 1500);
        
      } catch (error) {
        console.error('Registration error:', error);
        utils.hideLoading();
        
        let errorMessage = 'Registration failed. Please try again.';
        
        if (error.code === 'auth/email-already-in-use') {
          errorMessage = 'This email is already registered.';
        } else if (error.code === 'auth/invalid-email') {
          errorMessage = 'Invalid email address.';
        } else if (error.code === 'auth/weak-password') {
          errorMessage = 'Password is too weak.';
        } else if (error.message) {
          errorMessage = error.message;
        }
        
        utils.showToast(errorMessage, 'error');
      }
    });
  </script>
</body>
</html>
